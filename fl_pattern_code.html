<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FL Studio Style Sequencer</title>
    <style>
        :root {
            --bg-color: #282b30;
            --panel-color: #36393f;
            --text-color: #aebbc7;
            --step-default: #4a4d52;
            --step-accent: #3e4146;
            --step-active: #d66d66; /* FL Studio "Red" */
            --step-active-shadow: #ff8a82;
            --playhead: rgba(255, 255, 255, 0.15);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            user-select: none;
        }

        .container {
            background-color: var(--panel-color);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            border: 1px solid #1e2124;
        }

        /* Controls Header */
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }

        button.control-btn {
            background: #4a4d52;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 12px;
            transition: background 0.2s;
        }

        button.control-btn:hover {
            background: #5a5d63;
        }

        button.control-btn.playing {
            background: #d66d66;
            color: white;
        }

        .bpm-control {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        input[type="number"] {
            background: #222;
            border: 1px solid #444;
            color: #d66d66;
            padding: 5px;
            width: 50px;
            border-radius: 4px;
        }

        /* Sequencer Grid */
        .sequencer {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .track {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .track-name {
            width: 60px;
            font-size: 12px;
            font-weight: bold;
            text-align: right;
            color: #ccc;
        }

        .steps {
            display: flex;
            gap: 4px;
        }

        /* The Step Button */
        .step {
            width: 30px;
            height: 40px;
            background-color: var(--step-default);
            border-radius: 3px;
            cursor: pointer;
            border: 1px solid #222;
            position: relative;
        }

        /* Coloring every 4 steps differently (like FL bars) */
        .step:nth-child(4n+1), 
        .step:nth-child(4n+2), 
        .step:nth-child(4n+3), 
        .step:nth-child(4n+4) {
            background-color: var(--step-default);
        }

        /* Darker shade for the second set of 4 beats */
        .step:nth-child(n+5):nth-child(-n+8),
        .step:nth-child(n+13):nth-child(-n+16) {
            background-color: var(--step-accent);
        }

        /* Active State (Toggled On) */
        .step.active {
            background-color: var(--step-active);
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
            border-color: var(--step-active-shadow);
        }

        /* Playhead Indicator (Current playing column) */
        .step.playing {
            filter: brightness(1.5);
            border: 1px solid white;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="controls">
            <button id="playBtn" class="control-btn">Play</button>
            <button id="clearBtn" class="control-btn">Clear</button>
            <div class="bpm-control">
                <span>BPM</span>
                <input type="number" id="bpmInput" value="128" min="60" max="200">
            </div>
        </div>

        <div class="sequencer" id="sequencerGrid">
            <!-- Tracks will be generated by JS -->
        </div>
    </div>

    <script>
        // Configuration
        const trackNames = ["Kick", "Snare", "Hat", "Clap"];
        const stepsCount = 16;
        let isPlaying = false;
        let currentStep = 0;
        let bpm = 128;
        let intervalId = null;
        
        // Audio Context (Synthesizer)
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        // Grid State (Array of Arrays: 4 tracks x 16 steps)
        let grid = Array(trackNames.length).fill().map(() => Array(stepsCount).fill(false));

        // DOM Elements
        const sequencerGrid = document.getElementById('sequencerGrid');
        const playBtn = document.getElementById('playBtn');
        const clearBtn = document.getElementById('clearBtn');
        const bpmInput = document.getElementById('bpmInput');

        // --- Initialization ---

        function createGrid() {
            sequencerGrid.innerHTML = '';
            
            trackNames.forEach((name, trackIndex) => {
                const trackEl = document.createElement('div');
                trackEl.className = 'track';

                const nameEl = document.createElement('div');
                nameEl.className = 'track-name';
                nameEl.innerText = name;
                trackEl.appendChild(nameEl);

                const stepsContainer = document.createElement('div');
                stepsContainer.className = 'steps';

                for (let i = 0; i < stepsCount; i++) {
                    const stepBtn = document.createElement('div');
                    stepBtn.className = 'step';
                    stepBtn.dataset.track = trackIndex;
                    stepBtn.dataset.step = i;
                    
                    // Toggle Logic
                    stepBtn.addEventListener('click', () => {
                        grid[trackIndex][i] = !grid[trackIndex][i];
                        stepBtn.classList.toggle('active');
                    });

                    stepsContainer.appendChild(stepBtn);
                }

                trackEl.appendChild(stepsContainer);
                sequencerGrid.appendChild(trackEl);
            });
        }

        // --- Audio Engine (Simple Synthesis) ---
        
        function playSound(trackName) {
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }

            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            const now = audioCtx.currentTime;

            if (trackName === "Kick") {
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.exponentialRampToValueAtTime(0.01, now + 0.5);
                gainNode.gain.setValueAtTime(1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
                osc.start(now);
                osc.stop(now + 0.5);
            } 
            else if (trackName === "Snare") {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(100, now);
                gainNode.gain.setValueAtTime(0.5, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
                // (Simplified snare: a real one needs noise buffer)
            }
            else if (trackName === "Hat") {
                osc.type = 'square'; // Rough approximation for High Hat without noise buffer
                osc.frequency.setValueAtTime(800, now); // Lower freq to be less ear-piercing
                
                // High pass filter to make it sound "thin" like a hat
                const filter = audioCtx.createBiquadFilter();
                filter.type = "highpass";
                filter.frequency.value = 4000;
                
                osc.disconnect();
                osc.connect(filter);
                filter.connect(gainNode);

                gainNode.gain.setValueAtTime(0.3, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
                osc.start(now);
                osc.stop(now + 0.05);
            }
            else if (trackName === "Clap") {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(400, now);
                gainNode.gain.setValueAtTime(0.3, now);
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            }
        }

        // --- Sequencer Logic ---

        function nextStep() {
            // 1. Visual Update: Remove 'playing' class from previous column
            const prevStep = currentStep === 0 ? stepsCount - 1 : currentStep - 1;
            document.querySelectorAll(`.step[data-step="${prevStep}"]`).forEach(el => el.classList.remove('playing'));

            // 2. Visual Update: Add 'playing' class to current column
            document.querySelectorAll(`.step[data-step="${currentStep}"]`).forEach(el => el.classList.add('playing'));

            // 3. Audio Trigger
            grid.forEach((trackSteps, trackIndex) => {
                if (trackSteps[currentStep]) {
                    playSound(trackNames[trackIndex]);
                }
            });

            // 4. Increment Step
            currentStep = (currentStep + 1) % stepsCount;
        }

        function togglePlay() {
            isPlaying = !isPlaying;
            
            if (isPlaying) {
                playBtn.innerText = "Stop";
                playBtn.classList.add('playing');
                currentStep = 0;
                
                // Calculate Playback Speed
                // 60 seconds / BPM / 4 (because 16th notes) * 1000 for ms
                const interval = (60 / bpm) / 4 * 1000;
                
                nextStep(); // Play first immediately
                intervalId = setInterval(nextStep, interval);
            } else {
                playBtn.innerText = "Play";
                playBtn.classList.remove('playing');
                clearInterval(intervalId);
                // Reset visuals
                document.querySelectorAll('.step.playing').forEach(el => el.classList.remove('playing'));
            }
        }

        // --- Event Listeners ---

        playBtn.addEventListener('click', togglePlay);

        clearBtn.addEventListener('click', () => {
            grid = grid.map(row => row.fill(false));
            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
            if (isPlaying) togglePlay();
        });

        bpmInput.addEventListener('change', (e) => {
            bpm = e.target.value;
            if (isPlaying) {
                // Restart to apply new BPM
                togglePlay(); 
                togglePlay();
            }
        });

        // Run init
        createGrid();

    </script>
</body>
</html>